<style>
    .form-step {
        display: none;
    }

    .form-step.active {
        display: block;
    }
</style>

<header class="hero py-5">
    <div class="container">
        <h1 class="h3 fw-bold mb-1">Create your RightSeat account</h1>
        <p class="text-secondary mb-0">
            Set up your organization or sign up as an independent CFI in a few steps.
        </p>
    </div>
</header>

<main class="container py-4">
    <div class="row g-4">
        <!-- Content: Wizard -->
        <section class="col-lg-6 mx-auto">
            <form id="signupForm" class="card shadow-sm" action="/sign-up" method="POST">
                <div class="card-body">
                    <!-- Step 1: Subscription -->
                    <div class="form-step active" data-step="1">
                        <h2 class="h5 fw-bold mb-3">
                            Choose your subscription
                        </h2>
                        <div class="row g-3">
                            <% subscriptions.filter(sub=> !sub.requiresSales).forEach(sub => { %>
                                <div class="col-md-12">
                                    <label class="form-check border rounded p-3 h-100">
                                        <input class="form-check-input me-2" type="radio" name="subscription"
                                            value="<%= sub.subscription_id  %>" <% if (sub.subscription_key==='trial' )
                                            { %> checked <% } %> />
                                            <span class="fw-semibold d-block">
                                                <%= sub.label %> (<%= sub.price ? `$${sub.price}/month` : 'FREE' %>)
                                            </span>
                                            <span class="text-secondary small d-block mt-1">
                                                <%= sub.summary %>
                                            </span>
                                    </label>
                                </div>
                                <% }) %>
                        </div>

                        <div class="d-flex justify-content-end gap-2 mt-4">
                            <button type="button" class="btn btn-rs" data-next>
                                Continue
                            </button>
                        </div>
                    </div>

                    <!-- Step 2: Details -->
                    <div class="form-step" data-step="2">
                        <h2 class="h5 fw-bold mb-3">Account details</h2>

                        <!-- Org details (visible for school role) -->
                        <div id="orgFields">
                            <div class="row g-3">
                                <div class="col-md-6">
                                    <label class="form-label" for="orgName">Organization name</label>
                                    <input id="orgName" class="form-control" name="orgName"
                                        placeholder="e.g., Skyline Flight Center" />
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label" for="orgPhone">School phone</label>
                                    <input id="orgPhone" class="form-control" name="orgPhone"
                                        placeholder="(555) 123-4567" />
                                </div>
                            </div>
                            <hr />
                        </div>

                        <!-- Personal -->
                        <div class="row g-3">
                            <div class="col-md-6">
                                <label class="form-label">First name</label>
                                <input class="form-control" name="firstName" required />
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Last name</label>
                                <input class="form-control" name="lastName" required />
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Work email</label>
                                <input type="email" class="form-control" name="email" required />
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Password</label>
                                <input type="password" class="form-control" name="password" minlength="8"
                                    placeholder="At least 8 characters" required />
                            </div>
                        </div>

                        <div class="d-flex justify-content-between gap-2 mt-4">
                            <button type="button" class="btn btn-outline-secondary" data-prev>
                                Back
                            </button>
                            <button type="button" class="btn btn-rs" data-next>
                                Continue
                            </button>
                        </div>
                    </div>

                    <!-- Step 4: Review -->
                    <div class="form-step" data-step="4">
                        <h2 class="h5 fw-bold mb-3">Review & submit</h2>

                        <div class="row g-4">
                            <div class="col-md-12">
                                <div class="border rounded p-3 h-100">
                                    <div class="fw-semibold mb-2">Account</div>
                                    <div class="small">
                                        <span class="text-secondary">Role:</span>
                                        <span id="revRole">—</span>
                                    </div>
                                    <div class="small">
                                        <span class="text-secondary">Name:</span>
                                        <span id="revName">—</span>
                                    </div>
                                    <div class="small">
                                        <span class="text-secondary">Email:</span>
                                        <span id="revEmail">—</span>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-12" id="revOrgCard">
                                <div class="border rounded p-3 h-100">
                                    <div class="fw-semibold mb-2">
                                        Organization
                                    </div>
                                    <div class="small">
                                        <span class="text-secondary">Name:</span>
                                        <span id="revOrg">—</span>
                                    </div>
                                    <div class="small">
                                        <span class="text-secondary">Phone Number:</span>
                                        <span id="revPhone">—</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="alert alert-info d-flex align-items-center gap-2 mt-3">
                            <i class="bi bi-info-circle"></i>
                            <div class="small">
                                You can change plan and invite CFIs after signup.
                            </div>
                        </div>

                        <div id="reviewErrors" class="alert alert-danger d-none">
                            <div class="fw-semibold mb-2">Please fix the following before submitting:</div>
                            <ul id="errorList" class="mb-0"></ul>
                        </div>

                        <div class="d-flex justify-content-between gap-2 mt-4">
                            <button type="button" class="btn btn-outline-secondary" data-prev>
                                Back
                            </button>
                            <button type="submit" class="btn btn-rs">
                                Create account
                            </button>
                        </div>
                    </div>
                </div>
            </form>
        </section>
    </div>
</main>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
    // small helpers
    const query = (selector) => document.querySelector(selector);
    const queryAll = (selector) => [...document.querySelectorAll(selector)];

    // Define main variables
    const steps = queryAll('.form-step');
    let current = 0;

    // set up functions

    // Steps in wizard
    function showStep(i) {
        steps.forEach((s, idx) => s.classList.toggle('active', idx === i));
    }

    // Next buttons
    queryAll('[data-next]').forEach((btn) =>
        btn.addEventListener('click', () => {
            if (current < steps.length - 1) {
                current++;
                refreshReview();
                showStep(current);
            }
        })
    );

    // Prev buttons
    queryAll('[data-prev]').forEach((btn) =>
        btn.addEventListener('click', () => {
            if (current > 0) {
                current--;
                refreshReview();
                showStep(current);
            }
        })
    );

    // Role toggling
    const roleInputs = queryAll('input[name="subscription"]');
    const orgFields = document.getElementById('orgFields');
    const revOrgCard = document.getElementById('revOrgCard');

    function toggleRole() {
        const role = query('input[name="subscription"]:checked')?.value || '3';
        const isSchool = role === '3';
        orgFields.style.display = isSchool ? '' : 'none';
        revOrgCard.style.display = isSchool ? '' : 'none';
    }
    roleInputs.forEach((r) => r.addEventListener('change', toggleRole));
    toggleRole();

    // Review population
    function getVal(name) {
        return query(`[name="${name}"]`)?.value?.trim() || '—';
    }
    function refreshReview() {
        const role = query('input[name="subscription"]:checked')?.value || '3';
        document.getElementById('revRole').textContent = role === '3' ? 'Flight School Admin' : 'Independent CFI';
        document.getElementById('revName').textContent = `${getVal('firstName')} ${getVal('lastName')}`.trim();
        document.getElementById('revEmail').textContent = getVal('email');
        document.getElementById('revOrg').textContent = getVal('orgName');
        document.getElementById('revPhone').textContent = getVal('orgPhone');
    }
    refreshReview();
</script>
